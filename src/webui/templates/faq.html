{% extends "base.html" %}

{% block title %}FAQ - Mirai IT Knowledge System{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">
            â“ ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰
        </h1>
        <p class="text-gray-600">ãƒŠãƒ¬ãƒƒã‚¸ã‚·ã‚¹ãƒ†ãƒ ã«é–¢ã™ã‚‹ã‚ˆãã‚ã‚‹è³ªå•ã¨å›ç­”</p>
    </div>

    <!-- æ¤œç´¢ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <form method="GET" action="/faq" class="space-y-4">
            <div class="flex gap-4">
                <div class="flex-1">
                    <input
                        type="text"
                        name="q"
                        value="{{ search_query or '' }}"
                        placeholder="FAQã‚’æ¤œç´¢..."
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>
                <button
                    type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                >
                    ğŸ” æ¤œç´¢
                </button>
            </div>

            <div class="flex gap-2 flex-wrap">
                <a href="/faq" class="px-4 py-2 {% if not selected_category %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700{% endif %} rounded-lg hover:bg-blue-500 hover:text-white">
                    ã™ã¹ã¦
                </a>
                {% for cat in categories %}
                <a href="/faq?category={{ cat }}" class="px-4 py-2 {% if selected_category == cat %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700{% endif %} rounded-lg hover:bg-blue-500 hover:text-white">
                    {{ cat }}
                </a>
                {% endfor %}
            </div>
        </form>
    </div>

    <!-- FAQä¸€è¦§ -->
    <div class="space-y-4">
        {% if faqs %}
            {% for faq in faqs %}
            <div class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 flex-1">
                            â“ {{ faq.question }}
                        </h3>
                        {% if faq.category %}
                        <span class="ml-4 px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                            {{ faq.category }}
                        </span>
                        {% endif %}
                    </div>

                    <div class="text-gray-700 mb-4 whitespace-pre-wrap">{{ faq.answer }}</div>

                    <div class="flex items-center justify-between text-sm text-gray-500 border-t pt-4">
                        <div class="flex gap-4">
                            <span>ğŸ‘ï¸ {{ faq.view_count }} é–²è¦§</span>
                            <span>ğŸ‘ {{ faq.helpful_count }} å½¹ç«‹ã£ãŸ</span>
                            {% if faq.not_helpful_count > 0 %}
                            <span>ğŸ‘ {{ faq.not_helpful_count }}</span>
                            {% endif %}
                        </div>
                        <div class="flex gap-2">
                            <button
                                onclick="submitFeedback({{ faq.id }}, true)"
                                class="px-3 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200"
                            >
                                ğŸ‘ å½¹ç«‹ã£ãŸ
                            </button>
                            <button
                                onclick="submitFeedback({{ faq.id }}, false)"
                                class="px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"
                            >
                                ğŸ‘ å½¹ç«‹ãŸãªã„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="bg-white rounded-lg shadow p-8 text-center">
                <p class="text-gray-500">è©²å½“ã™ã‚‹FAQãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
async function submitFeedback(faqId, isHelpful) {
    try {
        const response = await fetch(`/api/faq/${faqId}/feedback`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                is_helpful: isHelpful
            })
        });

        const data = await response.json();

        if (data.success) {
            alert('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼');
            location.reload();
        } else {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}
</script>
{% endblock %}
