{% extends "base.html" %}

{% block title %}{{ knowledge.title }} - Mirai IT Knowledge Systems{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <span aria-hidden="true">ğŸ“„</span> ãƒŠãƒ¬ãƒƒã‚¸è©³ç´°
    </h1>
    <p class="page-description">ãƒŠãƒ¬ãƒƒã‚¸ã®å†…å®¹ãƒ»è¦ç´„ãƒ»ã‚¿ã‚°ã‚’ç¢ºèªã§ãã¾ã™ã€‚</p>
</div>

<div class="card">
    <div class="card-header" style="align-items: flex-start;">
        <h2 class="card-title">
            {{ knowledge.title }}
            {% if knowledge.is_sample %}
            <span class="badge badge-sample" style="background: #f0f0f0; color: #666; margin-left: 0.5rem;">ğŸ“‹ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</span>
            {% endif %}
            {% if knowledge.source_type == 'ai_chat' %}
            <span class="badge badge-ai" style="background: #4CAF50; color: white; margin-left: 0.5rem;">ğŸ¤– AIä½œæˆ</span>
            {% endif %}
        </h2>
        <span class="badge badge-{{ knowledge.itsm_type.lower() }}">
            {% if knowledge.itsm_type == 'Incident' %}ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
            {% elif knowledge.itsm_type == 'Problem' %}å•é¡Œç®¡ç†
            {% elif knowledge.itsm_type == 'Change' %}å¤‰æ›´ç®¡ç†
            {% elif knowledge.itsm_type == 'Release' %}ãƒªãƒªãƒ¼ã‚¹ç®¡ç†
            {% elif knowledge.itsm_type == 'Request' %}ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            {% else %}ãã®ä»–{% endif %}
        </span>
    </div>

    <div class="card-body">
        <div class="grid grid-3" style="margin-bottom: 1rem;">
            <div class="chip">ä½œæˆæ—¥: {{ knowledge.created_at[:10] }}</div>
            <div class="chip">æ›´æ–°æ—¥: {{ knowledge.updated_at[:10] }}</div>
            {% if knowledge.created_by %}
            <div class="chip">ä½œæˆè€…: {{ knowledge.created_by }}</div>
            {% endif %}
        </div>

        {% if knowledge.summary_technical %}
        <div class="alert alert-info" style="margin-bottom: 1rem;">
            <strong>ğŸ“ æŠ€è¡“è€…å‘ã‘è¦ç´„</strong><br>
            {{ knowledge.summary_technical }}
        </div>
        {% endif %}

        {% if knowledge.summary_non_technical %}
        <div class="alert" style="background:#f3e5f5; border-left: 4px solid #7b1fa2; margin-bottom: 1rem;">
            <strong>ğŸ‘¥ éæŠ€è¡“è€…å‘ã‘è¦ç´„</strong><br>
            {{ knowledge.summary_non_technical }}
        </div>
        {% endif %}

        {% if knowledge.tags %}
        <div style="margin-bottom: 1rem;">
            <strong>ğŸ·ï¸ ã‚¿ã‚°:</strong>
            <div class="tags" style="margin-top: 0.5rem;">
                {% for tag in knowledge.tags %}
                <span class="tag">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <h3 style="margin-top: 1.5rem; margin-bottom: 0.75rem;">ğŸ“„ è©³ç´°å†…å®¹</h3>
        <div style="line-height: 1.8; white-space: pre-wrap; color: var(--color-text-secondary);">
            {{ knowledge.content }}
        </div>

        {% if knowledge.insights %}
        <div class="card" style="margin-top: 1.5rem; background: #fff3e0;">
            <h3>ğŸ’¡ æŠ½å‡ºã•ã‚ŒãŸçŸ¥è¦‹</h3>
            <ul style="margin-left: 1.2rem; line-height: 1.8;">
                {% for insight in knowledge.insights %}
                <li>{{ insight }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>

{% if related %}
<div class="card">
    <h3>ğŸ”— é–¢é€£ãƒŠãƒ¬ãƒƒã‚¸</h3>
    <ul style="list-style: none;">
        {% for rel in related %}
        <li style="padding: 0.75rem 0; border-bottom: 1px solid #eee;">
            <a href="/knowledge/{{ rel.id }}" style="color: var(--color-primary); text-decoration: none;">
                {{ rel.title }}
            </a>
            <span class="badge badge-{{ rel.itsm_type.lower() }}" style="margin-left: 0.5rem;">
                {{ rel.itsm_type }}
            </span>
            {% if rel.relationship_type %}
            <small style="color: #666; display: block; margin-top: 0.25rem;">
                é–¢ä¿‚: {{ rel.relationship_type }}
            </small>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<div style="margin-top: 1.5rem;">
    <a href="/knowledge/search" class="btn btn-outline">ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>
{% endblock %}
