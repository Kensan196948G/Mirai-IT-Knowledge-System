{% extends "base.html" %}

{% block title %}ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢ - Mirai IT Knowledge Systems{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <span aria-hidden="true">ğŸ”</span> ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢
    </h1>
    <p class="page-description">
        ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ITSMã‚¿ã‚¤ãƒ—ã€ã‚¿ã‚°ã§ãƒŠãƒ¬ãƒƒã‚¸ã‚’æ¤œç´¢ã§ãã¾ã™
    </p>
</div>

<section class="section">
    <div class="card" style="margin-bottom: 1.5rem;">
        <form id="searchForm" method="POST" action="/knowledge/search" role="search">
            <div class="search-box">
                <input
                    type="search"
                    id="searchInput"
                    name="query"
                    placeholder="ä¾‹: Webã‚µãƒ¼ãƒãƒ¼ 503ã‚¨ãƒ©ãƒ¼"
                    aria-label="ãƒŠãƒ¬ãƒƒã‚¸ã‚’æ¤œç´¢"
                    value="{{ query or '' }}"
                >
            </div>
            <p class="form-help">
                è‡ªç„¶ãªè¨€è‘‰ã§æ¤œç´¢ã§ãã¾ã™ã€‚è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ã™ã¹ã¦ã‚’å«ã‚€ãƒŠãƒ¬ãƒƒã‚¸ãŒæ¤œç´¢ã•ã‚Œã¾ã™ã€‚
            </p>
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <select class="form-select" name="itsm_type" aria-label="ITSMã‚¿ã‚¤ãƒ—">
                    <option value="">ã™ã¹ã¦</option>
                    <option value="Incident" {% if itsm_type_filter == 'Incident' %}selected{% endif %}>ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ</option>
                    <option value="Problem" {% if itsm_type_filter == 'Problem' %}selected{% endif %}>å•é¡Œç®¡ç†</option>
                    <option value="Change" {% if itsm_type_filter == 'Change' %}selected{% endif %}>å¤‰æ›´ç®¡ç†</option>
                    <option value="Release" {% if itsm_type_filter == 'Release' %}selected{% endif %}>ãƒªãƒªãƒ¼ã‚¹ç®¡ç†</option>
                    <option value="Request" {% if itsm_type_filter == 'Request' %}selected{% endif %}>ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</option>
                </select>
                <button class="btn btn-primary" type="submit">æ¤œç´¢</button>
                <a href="/knowledge/search" class="btn btn-outline">ã‚¯ãƒªã‚¢</a>
            </div>
        </form>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            æ¤œç´¢çµæœ <span style="color: var(--color-text-secondary);">({{ results|length }}ä»¶)</span>
        </h2>
    </div>

    {% if results %}
    <div class="content-grid">
        {% for knowledge in results %}
        <article class="knowledge-card {{ knowledge.itsm_type|lower }}" tabindex="0" role="button" onclick="location.href='/knowledge/{{ knowledge.id }}'">
            <div class="card-header">
                <h3 class="card-title">{{ knowledge.title }}</h3>
                <span class="badge badge-{{ knowledge.itsm_type|lower }}" role="status">
                    {% if knowledge.itsm_type == 'Incident' %}ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
                    {% elif knowledge.itsm_type == 'Problem' %}å•é¡Œç®¡ç†
                    {% elif knowledge.itsm_type == 'Change' %}å¤‰æ›´ç®¡ç†
                    {% elif knowledge.itsm_type == 'Release' %}ãƒªãƒªãƒ¼ã‚¹ç®¡ç†
                    {% elif knowledge.itsm_type == 'Request' %}ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                    {% else %}ãã®ä»–{% endif %}
                </span>
            </div>
            <p class="card-summary">
                {{ knowledge.summary_non_technical or knowledge.content[:100] }}{% if (knowledge.summary_non_technical or knowledge.content)|length > 100 %}...{% endif %}
            </p>
            <div class="card-footer">
                <span><span aria-hidden="true">ğŸ·ï¸</span> {{ (knowledge.tags or [])|join(', ') }}</span>
                <time datetime="{{ knowledge.created_at[:10] }}">{{ knowledge.created_at[:10] }}</time>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ”</div>
        <h3>æ¤œç´¢æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒŠãƒ¬ãƒƒã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</h3>
        <p style="margin-top: 1rem;">
            <a href="/knowledge/search" class="btn btn-outline">æ¤œç´¢æ¡ä»¶ã‚’å¤‰æ›´</a>
        </p>
    </div>
    {% endif %}
</section>
{% endblock %}
