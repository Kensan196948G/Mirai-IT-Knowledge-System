{% extends "base.html" %}

{% block title %}åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - Mirai IT Knowledge Systems{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb">
    <div class="breadcrumb-content">
        <a href="/">ãƒ›ãƒ¼ãƒ </a>
        <span class="breadcrumb-separator">â€º</span>
        <span>åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
    </div>
</div>
{% endblock %}

{% block content %}
<h2 style="margin-bottom: 1.5rem;">ğŸ“Š åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h2>

<!-- Feedback Summary -->
<div class="card" style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-left: 4px solid var(--color-primary);">
    <h3 style="color: var(--color-primary); margin-bottom: 1rem;">ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚µãƒãƒªãƒ¼</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="background: white; padding: 1rem; border-radius: 4px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: var(--color-primary);">
                {{ feedback_summary.knowledge_feedback.total_feedback or 0 }}
            </div>
            <div style="color: #666; font-size: 0.9rem;">ãƒŠãƒ¬ãƒƒã‚¸ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</div>
        </div>
        <div style="background: white; padding: 1rem; border-radius: 4px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #f57c00;">
                {{ "%.1f"|format(feedback_summary.knowledge_feedback.avg_rating or 0) }} â˜…
            </div>
            <div style="color: #666; font-size: 0.9rem;">å¹³å‡è©•ä¾¡</div>
        </div>
        <div style="background: white; padding: 1rem; border-radius: 4px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #4CAF50;">
                {{ feedback_summary.knowledge_feedback.knowledge_with_feedback or 0 }}
            </div>
            <div style="color: #666; font-size: 0.9rem;">è©•ä¾¡æ¸ˆã¿ãƒŠãƒ¬ãƒƒã‚¸</div>
        </div>
        <div style="background: white; padding: 1rem; border-radius: 4px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #2196F3;">
                {{ feedback_summary.system_feedback.total_feedback or 0 }}
            </div>
            <div style="color: #666; font-size: 0.9rem;">ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</div>
        </div>
    </div>
</div>

<!-- Popular Knowledge -->
<div class="card">
    <h3 style="color: #f57c00; margin-bottom: 1rem;">ğŸ”¥ äººæ°—ã®ãƒŠãƒ¬ãƒƒã‚¸ï¼ˆ30æ—¥é–“ï¼‰</h3>
    {% if popular_knowledge %}
    <table>
        <thead>
            <tr>
                <th style="width: 60px;">é †ä½</th>
                <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                <th style="width: 120px;">ã‚¿ã‚¤ãƒ—</th>
                <th style="width: 100px;">é–²è¦§æ•°</th>
            </tr>
        </thead>
        <tbody>
            {% for knowledge in popular_knowledge %}
            <tr onclick="window.location.href='/knowledge/{{ knowledge.id }}'" style="cursor: pointer;">
                <td style="text-align: center; font-weight: bold; color: #f57c00;">
                    #{{ loop.index }}
                </td>
                <td>
                    <a href="/knowledge/{{ knowledge.id }}" style="color: var(--color-primary); text-decoration: none; font-weight: 500;">
                        {{ knowledge.title }}
                    </a>
                </td>
                <td>
                    <span class="badge badge-{{ knowledge.itsm_type.lower() }}">
                        {% if knowledge.itsm_type == 'Incident' %}ğŸš¨
                        {% elif knowledge.itsm_type == 'Problem' %}ğŸ”
                        {% elif knowledge.itsm_type == 'Change' %}ğŸ”§
                        {% elif knowledge.itsm_type == 'Release' %}ğŸš€
                        {% elif knowledge.itsm_type == 'Request' %}ğŸ“
                        {% else %}ğŸ“„{% endif %}
                        {{ knowledge.itsm_type }}
                    </span>
                </td>
                <td style="text-align: center; font-weight: bold;">
                    {{ knowledge.view_count }} å›
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ“Š</div>
        <p>ã¾ã é–²è¦§çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
    </div>
    {% endif %}
</div>

<!-- Top Rated Knowledge -->
<div class="card">
    <h3 style="color: #4CAF50; margin-bottom: 1rem;">â­ è©•ä¾¡ã®é«˜ã„ãƒŠãƒ¬ãƒƒã‚¸</h3>
    {% if top_rated %}
    <table>
        <thead>
            <tr>
                <th style="width: 60px;">é †ä½</th>
                <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                <th style="width: 120px;">ã‚¿ã‚¤ãƒ—</th>
                <th style="width: 100px;">å¹³å‡è©•ä¾¡</th>
                <th style="width: 100px;">è©•ä¾¡æ•°</th>
            </tr>
        </thead>
        <tbody>
            {% for knowledge in top_rated %}
            <tr onclick="window.location.href='/knowledge/{{ knowledge.id }}'" style="cursor: pointer;">
                <td style="text-align: center; font-weight: bold; color: #4CAF50;">
                    #{{ loop.index }}
                </td>
                <td>
                    <a href="/knowledge/{{ knowledge.id }}" style="color: var(--color-primary); text-decoration: none; font-weight: 500;">
                        {{ knowledge.title }}
                    </a>
                </td>
                <td>
                    <span class="badge badge-{{ knowledge.itsm_type.lower() }}">
                        {% if knowledge.itsm_type == 'Incident' %}ğŸš¨
                        {% elif knowledge.itsm_type == 'Problem' %}ğŸ”
                        {% elif knowledge.itsm_type == 'Change' %}ğŸ”§
                        {% elif knowledge.itsm_type == 'Release' %}ğŸš€
                        {% elif knowledge.itsm_type == 'Request' %}ğŸ“
                        {% else %}ğŸ“„{% endif %}
                        {{ knowledge.itsm_type }}
                    </span>
                </td>
                <td style="text-align: center;">
                    <span style="color: #ffa000; font-weight: bold;">
                        {{ "%.1f"|format(knowledge.avg_rating) }} â˜…
                    </span>
                </td>
                <td style="text-align: center; color: #666;">
                    {{ knowledge.feedback_count }} ä»¶
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">â­</div>
        <p>ã¾ã è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
        <small style="color: #999;">ãƒŠãƒ¬ãƒƒã‚¸ã«è©•ä¾¡ã‚’ä»˜ã‘ã‚‹ã¨ã€ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</small>
    </div>
    {% endif %}
</div>

<!-- System Feedback by Category -->
{% if feedback_summary.feedback_by_category %}
<div class="card">
    <h3 style="color: #2196F3; margin-bottom: 1rem;">ğŸ“ˆ ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
        {% for category, count in feedback_summary.feedback_by_category.items() %}
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; text-align: center;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #2196F3;">{{ count }}</div>
            <div style="color: #666; font-size: 0.9rem;">{{ category }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div style="text-align: center; margin: 2rem 0;">
    <a href="/feedback" class="btn btn-secondary">ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ã‚‹</a>
    <a href="/dashboard" class="btn btn-secondary" style="margin-left: 1rem;">ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
    <a href="/" class="btn btn-secondary" style="margin-left: 1rem;">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
</div>

<!-- Info Note -->
<div class="card" style="background: #fffbf0; border-left: 4px solid #ffa726;">
    <h4 style="color: #f57c00; margin-bottom: 0.5rem;">ğŸ’¡ åˆ†æã«ã¤ã„ã¦</h4>
    <ul style="line-height: 1.8; color: #666; margin-left: 1.5rem;">
        <li>äººæ°—ã®ãƒŠãƒ¬ãƒƒã‚¸ã¯éå»30æ—¥é–“ã®é–²è¦§æ•°ã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã•ã‚Œã¾ã™</li>
        <li>è©•ä¾¡ã®é«˜ã„ãƒŠãƒ¬ãƒƒã‚¸ã¯å¹³å‡è©•ä¾¡ã¨è©•ä¾¡æ•°ã‚’ç·åˆçš„ã«åˆ¤æ–­ã—ã¾ã™ï¼ˆæœ€ä½3ä»¶ã®è©•ä¾¡ãŒå¿…è¦ï¼‰</li>
        <li>ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«é›†è¨ˆã•ã‚Œã€æ”¹å–„ã®å„ªå…ˆé †ä½ä»˜ã‘ã«æ´»ç”¨ã•ã‚Œã¾ã™</li>
        <li>ã‚ˆã‚Šè©³ç´°ãªåˆ†æã¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç¢ºèªã§ãã¾ã™</li>
    </ul>
</div>
{% endblock %}
