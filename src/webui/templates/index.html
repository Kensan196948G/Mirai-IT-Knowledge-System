{% extends "base.html" %}

{% block title %}ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ - Mirai IT Knowledge Systems{% endblock %}

{% block content %}
{% set counts = stats.by_itsm_type or {} %}
{% set incident = counts.get('Incident', 0) %}
{% set problem = counts.get('Problem', 0) %}
{% set change = counts.get('Change', 0) %}
{% set release = counts.get('Release', 0) %}
{% set request = counts.get('Request', 0) %}

<section class="section" aria-labelledby="stats-heading">
    <h2 id="stats-heading" style="position: absolute; left: -9999px;">çµ±è¨ˆæƒ…å ±</h2>
    <div class="dashboard-grid">
        <div class="stats-card" role="article">
            <div class="stats-icon" aria-hidden="true">ğŸ“š</div>
            <div class="stats-value">{{ stats.total_knowledge }}</div>
            <div class="stats-label">ç·ãƒŠãƒ¬ãƒƒã‚¸æ•°</div>
        </div>
        <div class="stats-card" role="article" style="background: linear-gradient(135deg, #f44336 0%, #c62828 100%);" data-type="Incident">
            <div class="stats-icon" aria-hidden="true">ğŸš¨</div>
            <div class="stats-value">{{ incident }}</div>
            <div class="stats-label">ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ</div>
        </div>
        <div class="stats-card" role="article" style="background: linear-gradient(135deg, #ff9800 0%, #e65100 100%);" data-type="Problem">
            <div class="stats-icon" aria-hidden="true">ğŸ”</div>
            <div class="stats-value">{{ problem }}</div>
            <div class="stats-label">å•é¡Œç®¡ç†</div>
        </div>
        <div class="stats-card" role="article" style="background: linear-gradient(135deg, #2196F3 0%, #1565c0 100%);" data-type="Change">
            <div class="stats-icon" aria-hidden="true">ğŸ”§</div>
            <div class="stats-value">{{ change }}</div>
            <div class="stats-label">å¤‰æ›´ç®¡ç†</div>
        </div>
        <div class="stats-card" role="article" style="background: linear-gradient(135deg, #4CAF50 0%, #2e7d32 100%);" data-type="Release">
            <div class="stats-icon" aria-hidden="true">ğŸš€</div>
            <div class="stats-value">{{ release }}</div>
            <div class="stats-label">ãƒªãƒªãƒ¼ã‚¹ç®¡ç†</div>
        </div>
        <div class="stats-card" role="article" style="background: linear-gradient(135deg, #9C27B0 0%, #6a1b9a 100%);" data-type="Request">
            <div class="stats-icon" aria-hidden="true">ğŸ“</div>
            <div class="stats-value">{{ request }}</div>
            <div class="stats-label">ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</div>
        </div>
    </div>
</section>

<section class="section" aria-labelledby="modules-heading">
    <div class="section-header">
        <h2 id="modules-heading" class="section-title">
            <span aria-hidden="true">ğŸ§­</span> é‹ç”¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        </h2>
        <a href="/knowledge/search" class="btn btn-sm btn-outline">ä¸€è¦§ã‚’é–‹ã</a>
    </div>
    <div class="grid grid-3">
        <a href="/knowledge/search" class="module-card" role="article">
            <div class="module-icon">ğŸ“š</div>
            <h3 class="module-title">ç¤¾å†…ITãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§</h3>
            <p class="module-meta">æœ€æ–°åŒ–çŠ¶æ³ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã‚’å¯è¦–åŒ–</p>
            <span class="chip">{{ stats.total_knowledge }}ä»¶</span>
        </a>
        <a href="/knowledge/create" class="module-card" role="article">
            <div class="module-icon">âœï¸</div>
            <h3 class="module-title">ä½œæˆ</h3>
            <p class="module-meta">ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã‹ã‚‰ãƒŠãƒ¬ãƒƒã‚¸ã‚’å³æ™‚ç™»éŒ²</p>
            <span class="chip">å¹³å‡ 6åˆ†</span>
        </a>
        <a href="/knowledge/search" class="module-card" role="article">
            <div class="module-icon">ğŸ”</div>
            <h3 class="module-title">ç¤¾å†…ãƒŠãƒ¬ãƒƒã‚¸æ¤œç´¢</h3>
            <p class="module-meta">ã‚¿ã‚°ãƒ»ITSMã‚¿ã‚¤ãƒ—ã§æ¨ªæ–­æ¤œç´¢</p>
            <span class="chip">é«˜é€Ÿæ¤œç´¢</span>
        </a>
        <a href="/search/intelligent" class="module-card" role="article">
            <div class="module-icon">ğŸ§ </div>
            <h3 class="module-title">AIæ¤œç´¢</h3>
            <p class="module-meta">Claude/Gemini/Perplexityã®æ¤œç´¢ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¯è¦–åŒ–</p>
            <span class="chip chip-strong">çµ±åˆå›ç­”</span>
        </a>
        <a href="/serverfault" class="module-card" role="article">
            <div class="module-icon">ğŸ’¬</div>
            <h3 class="module-title">Server Faultè³ªå•</h3>
            <p class="module-meta">å¤–éƒ¨Q&Aã‚’å–ã‚Šè¾¼ã¿ãƒŠãƒ¬ãƒƒã‚¸åŒ–</p>
            <span class="chip">æœ€æ–°</span>
        </a>
        <div class="module-card" role="article">
            <div class="module-icon">ğŸ“Š</div>
            <h3 class="module-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
            <p class="module-meta">å…¨ä½“ KPI ã¨ç›´è¿‘ã®å®Ÿè¡ŒçŠ¶æ³</p>
            <span class="chip chip-warning">æ›´æ–° 5åˆ†å‰</span>
        </div>
    </div>
</section>

<section class="section" aria-labelledby="quick-actions-heading">
    <div class="card" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-left: 4px solid var(--color-primary);">
        <h2 id="quick-actions-heading" style="margin-bottom: 1rem;">
            <span aria-hidden="true">âš¡</span> ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
        </h2>
        <div class="grid grid-3">
            <a href="/knowledge/create" class="btn btn-primary" style="text-align: center; padding: 1rem;">
                <span aria-hidden="true">âœï¸</span> ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆ
            </a>
            <a href="/knowledge/search" class="btn btn-outline" style="text-align: center; padding: 1rem;">
                <span aria-hidden="true">ğŸ”</span> ç¤¾å†…æ¤œç´¢
            </a>
            <a href="/search/intelligent" class="btn btn-outline" style="text-align: center; padding: 1rem;">
                <span aria-hidden="true">ğŸ§ </span> AIæ¤œç´¢ã‚’å®Ÿè¡Œ
            </a>
        </div>
    </div>
</section>

<section class="section" aria-labelledby="recent-heading">
    <div class="card">
        <div class="card-header">
            <h2 id="recent-heading" class="card-title">
                <span aria-hidden="true">ğŸ“š</span> ç¤¾å†…ITãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§ï¼ˆæœ€æ–°ï¼‰
            </h2>
            <a href="/knowledge/search" class="btn btn-sm">ã™ã¹ã¦è¡¨ç¤º</a>
        </div>
        <div class="card-body">
            <div class="content-grid" id="recent-knowledge-list">
                {% if recent_knowledge %}
                    {% for knowledge in recent_knowledge[:10] %}
                    <article class="knowledge-card {{ knowledge.itsm_type|lower }}" tabindex="0" role="button" onclick="location.href='/knowledge/{{ knowledge.id }}'">
                        <div class="card-header">
                            <h3 class="card-title">
                                {{ knowledge.title }}
                                {% if knowledge.is_sample %}
                                <span class="badge badge-sample" style="background: #f0f0f0; color: #666; margin-left: 0.5rem;">ğŸ“‹ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿</span>
                                {% endif %}
                                {% if knowledge.source_type == 'ai_chat' %}
                                <span class="badge badge-ai" style="background: #4CAF50; color: white; margin-left: 0.5rem;">ğŸ¤– AIä½œæˆ</span>
                                {% endif %}
                            </h3>
                            <span class="badge badge-{{ knowledge.itsm_type|lower }}" role="status">
                                {% if knowledge.itsm_type == 'Incident' %}ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ
                                {% elif knowledge.itsm_type == 'Problem' %}å•é¡Œç®¡ç†
                                {% elif knowledge.itsm_type == 'Change' %}å¤‰æ›´ç®¡ç†
                                {% elif knowledge.itsm_type == 'Release' %}ãƒªãƒªãƒ¼ã‚¹ç®¡ç†
                                {% elif knowledge.itsm_type == 'Request' %}ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                                {% else %}ãã®ä»–{% endif %}
                            </span>
                        </div>
                        <p class="card-summary">
                            {{ knowledge.summary_non_technical or knowledge.content[:90] }}{% if (knowledge.summary_non_technical or knowledge.content)|length > 90 %}...{% endif %}
                        </p>
                        <div class="card-footer">
                            <span><span aria-hidden="true">ğŸ·ï¸</span> {{ (knowledge.tags or [])|join(', ') }}</span>
                            <time datetime="{{ knowledge.created_at[:10] }}">{{ knowledge.created_at[:10] }}</time>
                        </div>
                    </article>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>ã¾ã ãƒŠãƒ¬ãƒƒã‚¸ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                        <p style="margin-bottom: 1rem;">æœ€åˆã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
                        <a href="/knowledge/create" class="btn">æ–°ã—ã„ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆ</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    document.querySelectorAll('.stats-card[data-type]').forEach(card => {
        card.style.cursor = 'pointer';
        card.addEventListener('click', function() {
            const type = this.dataset.type;
            window.location.href = `/knowledge/search?itsm_type=${type}`;
        });
    });
</script>
{% endblock %}
