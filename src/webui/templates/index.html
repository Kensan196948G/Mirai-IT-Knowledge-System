{% extends "base.html" %}

{% block breadcrumb %}{% endblock %}

{% block content %}
<!-- Statistics Cards with Icons and Colors -->
<div class="stats">
    <div class="stat-card total" data-itsm-type="">
        <div class="stat-card-icon">ğŸ“š</div>
        <h3>{{ stats.total_knowledge }}</h3>
        <p>ç·ãƒŠãƒ¬ãƒƒã‚¸æ•°</p>
    </div>
    {% for itsm_type, count in stats.by_itsm_type.items() %}
    <div class="stat-card clickable {{ itsm_type.lower() }}" data-itsm-type="{{ itsm_type }}">
        <div class="stat-card-icon">
            {% if itsm_type == 'Incident' %}ğŸš¨
            {% elif itsm_type == 'Problem' %}ğŸ”
            {% elif itsm_type == 'Change' %}ğŸ”§
            {% elif itsm_type == 'Release' %}ğŸš€
            {% elif itsm_type == 'Request' %}ğŸ“
            {% else %}ğŸ“„{% endif %}
        </div>
        <h3>{{ count }}</h3>
        <p>{{ itsm_type }}</p>
        <small style="color: #999; font-size: 0.75rem;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦çµã‚Šè¾¼ã¿</small>
    </div>
    {% endfor %}
</div>

<!-- Quick Actions -->
<div class="card" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-left: 4px solid var(--color-primary);">
    <h2>âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <a href="/knowledge/create" class="btn" style="text-align: center; padding: 1rem;">
            âœï¸ æ–°ã—ã„ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆ
        </a>
        <a href="/knowledge/search" class="btn btn-secondary" style="text-align: center; padding: 1rem;">
            ğŸ” ãƒŠãƒ¬ãƒƒã‚¸ã‚’æ¤œç´¢
        </a>
        <a href="/analytics" class="btn btn-secondary" style="text-align: center; padding: 1rem;">
            ğŸ“Š åˆ†æã‚’è¦‹ã‚‹
        </a>
    </div>
</div>

<!-- Recent Knowledge -->
<div class="card">
    <h2>ğŸ“š æœ€è¿‘ã®ãƒŠãƒ¬ãƒƒã‚¸</h2>
    {% if recent_knowledge %}
    <table>
        <thead>
            <tr>
                <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
                <th style="width: 120px;">ã‚¿ã‚¤ãƒ—</th>
                <th style="width: 150px;">ä½œæˆæ—¥æ™‚</th>
            </tr>
        </thead>
        <tbody>
            {% for knowledge in recent_knowledge %}
            <tr onclick="window.location.href='/knowledge/{{ knowledge.id }}'" style="cursor: pointer;">
                <td>
                    <a href="/knowledge/{{ knowledge.id }}" style="color: var(--color-primary); text-decoration: none; font-weight: 500;">
                        {{ knowledge.title }}
                    </a>
                    {% if knowledge.summary_non_technical %}
                    <br>
                    <small style="color: #666;">{{ knowledge.summary_non_technical[:80] }}{% if knowledge.summary_non_technical|length > 80 %}...{% endif %}</small>
                    {% endif %}
                </td>
                <td>
                    <span class="badge badge-{{ knowledge.itsm_type.lower() }}">
                        {% if knowledge.itsm_type == 'Incident' %}ğŸš¨
                        {% elif knowledge.itsm_type == 'Problem' %}ğŸ”
                        {% elif knowledge.itsm_type == 'Change' %}ğŸ”§
                        {% elif knowledge.itsm_type == 'Release' %}ğŸš€
                        {% elif knowledge.itsm_type == 'Request' %}ğŸ“
                        {% else %}ğŸ“„{% endif %}
                        {{ knowledge.itsm_type }}
                    </span>
                </td>
                <td style="color: #666; font-size: 0.9rem;">
                    {{ knowledge.created_at[:16] }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <h3>ã¾ã ãƒŠãƒ¬ãƒƒã‚¸ãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p style="margin-bottom: 1rem;">æœ€åˆã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
        <a href="/knowledge/create" class="btn">æ–°ã—ã„ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆ</a>
    </div>
    {% endif %}
</div>

<!-- Quick Tips -->
<div class="card" style="background: #fffbf0; border-left: 4px solid #ffa726;">
    <h3 style="color: #f57c00; margin-bottom: 1rem;">ğŸ’¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
        <div>
            <h4 style="color: #555; margin-bottom: 0.5rem;">âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</h4>
            <ul style="color: #666; line-height: 1.8; margin-left: 1.5rem;">
                <li><kbd style="background: #eee; padding: 2px 6px; border-radius: 3px;">/</kbd> - æ¤œç´¢ãƒšãƒ¼ã‚¸ã¸</li>
                <li><kbd style="background: #eee; padding: 2px 6px; border-radius: 3px;">n</kbd> - æ–°è¦ä½œæˆãƒšãƒ¼ã‚¸ã¸</li>
                <li><kbd style="background: #eee; padding: 2px 6px; border-radius: 3px;">?</kbd> - ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º</li>
            </ul>
        </div>
        <div>
            <h4 style="color: #555; margin-bottom: 0.5rem;">ğŸ¯ çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã®ä½¿ã„æ–¹</h4>
            <p style="color: #666; line-height: 1.8;">
                å„ITSMã‚¿ã‚¤ãƒ—ã®ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚ŒãŸãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
            </p>
        </div>
        <div>
            <h4 style="color: #555; margin-bottom: 0.5rem;">ğŸ” æ¤œç´¢ã®ã‚³ãƒ„</h4>
            <p style="color: #666; line-height: 1.8;">
                è‡ªç„¶ãªè¨€è‘‰ã§æ¤œç´¢ã§ãã¾ã™ã€‚ä¾‹: ã€Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ æ¥ç¶šã‚¨ãƒ©ãƒ¼ã€ã€ŒWebã‚µãƒ¼ãƒãƒ¼ è¨¼æ˜æ›¸ã€
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†
// urlParams ã¯ base.html ã§æ—¢ã«å®£è¨€ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å†åˆ©ç”¨
const itsmFilter = urlParams.get('itsm_type');

if (itsmFilter) {
    // ãƒ•ã‚£ãƒ«ã‚¿ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è©²å½“ã‚«ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    document.querySelectorAll('.stat-card').forEach(card => {
        if (card.dataset.itsmType === itsmFilter) {
            card.style.background = '#f0f7ff';
            card.style.borderTopWidth = '6px';
        }
    });
}
</script>
{% endblock %}
