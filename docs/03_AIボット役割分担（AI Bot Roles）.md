# AIボット役割分担

## 役割分担の原則

3つのAIモデル（Claude, Gemini, Perplexity）の強みを活かし、以下の役割を分担します。
**OpenAI APIは使用しません。**

## 1. Claude (Anthropic) - 統合・最終回答生成

### 担当領域
- 最終回答の統合・生成
- 複数ソースからの情報整理
- 対話的な情報抽出
- 回答の品質保証

### 処理内容
```
入力: Gemini/Perplexityからの情報
処理: 統合・整形・品質チェック
出力: 最終回答（構造化 + 根拠分離）
```

### システムプロンプト例
```
あなたはITサポートの統合エージェントです。

役割:
1. 収集された情報を統合
2. 情シス担当者向けに最適化
3. 回答の品質を保証

出力要件:
- 簡潔で実用的
- 手順は番号付き
- 注意点を明示
- 根拠を分離出力
```

### 使用モデル
- `claude-sonnet-4-20250514`

---

## 2. Gemini - 情報収集・調査

### 担当領域
- 技術情報の収集
- トラブルシューティング調査
- ベストプラクティス検索
- FAQ対応の基礎情報収集

### 処理内容
```
入力: 技術的な質問
処理: 広範な情報収集、関連技術の調査
出力: 技術情報（構造化）
```

### 得意分野
- 最新技術動向
- 複数技術の比較
- 設定手順の調査
- エラー原因の特定

### 使用モデル
- `gemini-2.0-flash`

---

## 3. Perplexity - 根拠生成・エビデンス収集

### 担当領域
- エビデンスの収集
- ソースURLの取得
- 信頼性の検証
- リアルタイム情報取得

### 処理内容
```
入力: 回答に対する根拠要求
処理: Web検索、ソース収集
出力: 根拠リスト（URL付き）
```

### 出力形式
```json
{
  "evidence": [
    {
      "source": "Microsoft公式ドキュメント",
      "url": "https://docs.microsoft.com/...",
      "snippet": "関連する記述...",
      "relevance": 0.95
    }
  ],
  "confidence": 0.88
}
```

### 使用モデル
- `sonar`

---

## 処理フロー詳細

```
1. ユーザー問い合わせ受信
   ↓
2. 処理タイプ判定（FAQ/調査/根拠必要/一般）
   ↓
3. 並列処理実行
   ├─ Gemini: 技術情報収集（全タイプ）
   └─ Perplexity: 根拠収集（Investigation/Evidence時）
   ↓
4. Claude: 情報統合・最終回答生成
   ↓
5. 回答出力（本文 + エビデンス分離）
```

## クエリタイプ別ルーティング

| クエリタイプ | Gemini | Perplexity | Claude |
|-------------|--------|------------|--------|
| FAQ | ✅ 調査 | - | ✅ 統合 |
| Investigation | ✅ 調査 | ✅ 根拠 | ✅ 統合 |
| Evidence | ✅ 調査 | ✅ 根拠 | ✅ 統合 |
| General | ✅ 調査 | - | ✅ 統合 |

## 根拠分離出力

### 回答構造
```
【回答本文】
問題の解決手順は以下の通りです：
1. ...
2. ...
3. ...

【根拠・エビデンス】
- [Microsoft Docs] https://...
- [AWS Documentation] https://...

【信頼度スコア】
0.92
```

## パフォーマンス実績

| クエリタイプ | 使用AI | 信頼度 | 処理時間 |
|-------------|--------|--------|----------|
| FAQ | Gemini + Claude | 90% | 約17秒 |
| Investigation | Gemini + Perplexity + Claude | 85% | 約38秒 |
| Evidence | Gemini + Perplexity + Claude | 95% | 約31秒 |
