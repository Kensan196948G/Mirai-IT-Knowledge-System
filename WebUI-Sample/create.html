<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ–°è¦ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆ - Mirai IT Knowledge Systems">
    <title>æ–°è¦ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆ - Mirai IT Knowledge Systems</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <!-- Header -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <div>
                    <h1 class="header-title">Mirai IT Knowledge Systems</h1>
                    <p class="header-subtitle">ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªITãƒŠãƒ¬ãƒƒã‚¸ç®¡ç†</p>
                </div>
                <div class="header-actions">
                    <a href="index.html" class="btn" aria-label="ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹">
                        <span aria-hidden="true">ğŸ </span> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav" role="navigation" aria-label="ãƒ¡ã‚¤ãƒ³ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³">
        <div class="container nav-container">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span aria-hidden="true">ğŸ </span> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                    </a>
                </li>
                <li class="nav-item">
                    <a href="knowledge-list.html" class="nav-link">
                        <span aria-hidden="true">ğŸ“š</span> ãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§
                    </a>
                </li>
                <li class="nav-item">
                    <a href="create.html" class="nav-link active" aria-current="page">
                        <span aria-hidden="true">âœï¸</span> ä½œæˆ
                    </a>
                </li>
                <li class="nav-item">
                    <a href="search.html" class="nav-link">
                        <span aria-hidden="true">ğŸ”</span> ç¤¾å†…æ¤œç´¢
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ai-search.html" class="nav-link">
                        <span aria-hidden="true">ğŸ§ </span> AIæ¤œç´¢
                    </a>
                </li>
                <li class="nav-item">
                    <a href="sf-browser.html" class="nav-link">
                        <span aria-hidden="true">ğŸ’¬</span> Server Fault
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main" role="main">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">
                    <span aria-hidden="true">âœï¸</span> æ–°è¦ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆ
                </h1>
                <p class="page-description">
                    ITãƒŠãƒ¬ãƒƒã‚¸ã‚’è¨˜éŒ²ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã§å…±æœ‰ã—ã¾ã—ã‚‡ã†
                </p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer" role="alert" aria-live="polite"></div>

            <!-- Create Form -->
            <div class="card">
                <form id="createForm" onsubmit="submitKnowledge(event)">
                    <!-- Title -->
                    <div class="form-group">
                        <label for="title" class="form-label">
                            ã‚¿ã‚¤ãƒˆãƒ« <span style="color: var(--color-error);">*</span>
                        </label>
                        <input
                            type="text"
                            id="title"
                            name="title"
                            class="form-input"
                            required
                            placeholder="ä¾‹: Webã‚µãƒ¼ãƒãƒ¼ã®503ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å¯¾å¿œæ‰‹é †"
                            aria-required="true"
                            aria-describedby="titleHelp"
                        >
                        <small id="titleHelp" class="form-help">
                            ç°¡æ½”ã§ã‚ã‹ã‚Šã‚„ã™ã„ã‚¿ã‚¤ãƒˆãƒ«ã‚’ã¤ã‘ã¦ãã ã•ã„
                        </small>
                    </div>

                    <!-- Content -->
                    <div class="form-group">
                        <label for="content" class="form-label">
                            å†…å®¹ <span style="color: var(--color-error);">*</span>
                        </label>
                        <textarea
                            id="content"
                            name="content"
                            class="form-textarea"
                            required
                            placeholder="## ç™ºç”Ÿäº‹è±¡&#10;&#10;## å¯¾å¿œå†…å®¹&#10;&#10;## åŸå› &#10;&#10;## å¯¾ç­–"
                            style="min-height: 300px;"
                            aria-required="true"
                            aria-describedby="contentHelp"
                        ></textarea>
                        <small id="contentHelp" class="form-help">
                            Markdownå½¢å¼ã§è¨˜è¿°ã§ãã¾ã™ã€‚è¦‹å‡ºã—ã€ãƒªã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãªã©ãŒä½¿ç”¨å¯èƒ½ã§ã™
                        </small>
                    </div>

                    <!-- ITSM Type -->
                    <div class="form-group">
                        <label for="itsmType" class="form-label">
                            ITSMã‚¿ã‚¤ãƒ—
                        </label>
                        <select id="itsmType" name="itsmType" class="form-select" aria-describedby="itsmTypeHelp">
                            <option value="auto">è‡ªå‹•åˆ¤å®šï¼ˆæ¨å¥¨ï¼‰</option>
                            <option value="Incident">Incident - ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆç®¡ç†</option>
                            <option value="Problem">Problem - å•é¡Œç®¡ç†</option>
                            <option value="Change">Change - å¤‰æ›´ç®¡ç†</option>
                            <option value="Release">Release - ãƒªãƒªãƒ¼ã‚¹ç®¡ç†</option>
                            <option value="Request">Request - ã‚µãƒ¼ãƒ“ã‚¹ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</option>
                            <option value="Other">Other - ãã®ä»–</option>
                        </select>
                        <small id="itsmTypeHelp" class="form-help">
                            ã€Œè‡ªå‹•åˆ¤å®šã€ã‚’é¸æŠã™ã‚‹ã¨ã€AIãŒã‚¿ã‚¤ãƒˆãƒ«ã¨å†…å®¹ã‹ã‚‰ITSMã‚¿ã‚¤ãƒ—ã‚’è‡ªå‹•çš„ã«åˆ†é¡ã—ã¾ã™
                        </small>
                        <div id="itsmSuggestion" class="alert alert-info" style="display: none; margin-top: 0.5rem;">
                            <strong>AIæ¨å¥¨:</strong> <span id="suggestedType"></span>
                            <span id="suggestionConfidence" style="margin-left: 0.5rem;"></span>
                        </div>
                    </div>

                    <!-- Tags -->
                    <div class="form-group">
                        <label for="tags" class="form-label">
                            ã‚¿ã‚°
                        </label>
                        <input
                            type="text"
                            id="tags"
                            name="tags"
                            class="form-input"
                            placeholder="ä¾‹: Apache, ã‚¨ãƒ©ãƒ¼å¯¾å¿œ, éšœå®³"
                            aria-describedby="tagsHelp"
                        >
                        <small id="tagsHelp" class="form-help">
                            ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°ã®ã‚¿ã‚°ã‚’å…¥åŠ›ã§ãã¾ã™
                        </small>
                        <div id="tagSuggestions" style="margin-top: 0.5rem;"></div>
                    </div>

                    <!-- Created By -->
                    <div class="form-group">
                        <label for="createdBy" class="form-label">
                            ä½œæˆè€…
                        </label>
                        <input
                            type="text"
                            id="createdBy"
                            name="createdBy"
                            class="form-input"
                            value="webui_user"
                            placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
                            aria-describedby="createdByHelp"
                        >
                        <small id="createdByHelp" class="form-help">
                            ä½œæˆè€…ã®åå‰ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                        </small>
                    </div>

                    <!-- Form Actions -->
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <span aria-hidden="true">âœ…</span> ãƒŠãƒ¬ãƒƒã‚¸ã‚’ä½œæˆ
                        </button>
                        <button type="button" class="btn btn-outline" onclick="previewKnowledge()">
                            <span aria-hidden="true">ğŸ‘ï¸</span> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
                        </button>
                        <a href="index.html" class="btn btn-outline">
                            <span aria-hidden="true">âŒ</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </a>
                    </div>
                </form>
            </div>

            <!-- Creation Tips -->
            <section class="section">
                <div class="card" style="background: #fffbf0; border-left: 4px solid #ffa726;">
                    <h3 style="color: #f57c00; margin-bottom: 1rem;">
                        <span aria-hidden="true">ğŸ’¡</span> ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆã®ãƒ’ãƒ³ãƒˆ
                    </h3>
                    <ul style="line-height: 2; color: #666;">
                        <li>ã‚¿ã‚¤ãƒˆãƒ«ã¯ç°¡æ½”ã§ã‚ã‹ã‚Šã‚„ã™ã„ã‚‚ã®ã«ã—ã¦ãã ã•ã„</li>
                        <li>å†…å®¹ã¯Markdownå½¢å¼ã§è¨˜è¿°ã§ãã¾ã™ï¼ˆè¦‹å‡ºã—ã€ãƒªã‚¹ãƒˆã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãªã©ï¼‰</li>
                        <li>ç™ºç”Ÿæ—¥æ™‚ã€å½±éŸ¿ç¯„å›²ã€å¯¾å¿œæ‰‹é †ã€åŸå› ã€å¯¾ç­–ãªã©ã‚’å«ã‚ã‚‹ã¨å“è³ªãŒå‘ä¸Šã—ã¾ã™</li>
                        <li>æŠ€è¡“çš„ãªç”¨èªï¼ˆã‚³ãƒãƒ³ãƒ‰ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãªã©ï¼‰ã‚’å«ã‚ã‚‹ã¨è‡ªå‹•åˆ†æãŒã‚ˆã‚Šæ­£ç¢ºã«ãªã‚Šã¾ã™</li>
                        <li>ä½œæˆå¾Œã€AIã«ã‚ˆã‚‹å“è³ªãƒã‚§ãƒƒã‚¯ã¨é‡è¤‡æ¤œçŸ¥ãŒè‡ªå‹•çš„ã«è¡Œã‚ã‚Œã¾ã™</li>
                    </ul>
                </div>
            </section>

            <!-- Markdown Guide -->
            <section class="section">
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">
                        <span aria-hidden="true">ğŸ“</span> Markdownè¨˜æ³•ã‚¬ã‚¤ãƒ‰
                    </h3>
                    <div class="grid grid-2">
                        <div>
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">è¦‹å‡ºã—</h4>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto;">## å¤§è¦‹å‡ºã—
### ä¸­è¦‹å‡ºã—
#### å°è¦‹å‡ºã—</pre>
                        </div>
                        <div>
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">ãƒªã‚¹ãƒˆ</h4>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto;">- ç®‡æ¡æ›¸ãé …ç›®1
- ç®‡æ¡æ›¸ãé …ç›®2
  - ãƒã‚¹ãƒˆã•ã‚ŒãŸé …ç›®</pre>
                        </div>
                        <div>
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯</h4>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto;">```bash
systemctl restart apache2
```</pre>
                        </div>
                        <div>
                            <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">å¼·èª¿</h4>
                            <pre style="background: #f5f5f5; padding: 1rem; border-radius: 4px; overflow-x: auto;">**å¤ªå­—**
*æ–œä½“*
`ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰`</pre>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Preview Modal -->
    <div id="previewModal" class="modal" role="dialog" aria-labelledby="previewModalTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="previewModalTitle" class="modal-title">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                <button class="modal-close" onclick="closePreview()" aria-label="é–‰ã˜ã‚‹">&times;</button>
            </div>
            <div id="previewContent"></div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Mirai IT Knowledge Systems</h4>
                    <p>AIã‚’æ´»ç”¨ã—ãŸã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªITãƒŠãƒ¬ãƒƒã‚¸ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
                </div>
                <div class="footer-section">
                    <h4>ãƒªãƒ³ã‚¯</h4>
                    <p><a href="index.html">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a></p>
                    <p><a href="knowledge-list.html">ãƒŠãƒ¬ãƒƒã‚¸ä¸€è¦§</a></p>
                    <p><a href="search.html">ç¤¾å†…æ¤œç´¢</a></p>
                    <p><a href="ai-search.html">AIæ¤œç´¢</a></p>
                    <p><a href="create.html">ãƒŠãƒ¬ãƒƒã‚¸ä½œæˆ</a></p>
                </div>
                <div class="footer-section">
                    <h4>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</h4>
                    <p><a href="README.md">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</a></p>
                    <p><a href="#" aria-label="APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ">APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 Mirai IT Knowledge Systems. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ITSM Type Auto-suggestion
        let suggestionTimeout;

        function suggestITSMType() {
            clearTimeout(suggestionTimeout);
            suggestionTimeout = setTimeout(async () => {
                const title = document.getElementById('title').value;
                const content = document.getElementById('content').value;

                if (!title || !content) return;

                // Simulate AI classification (in production, this would be an API call)
                const classification = simulateClassification(title, content);

                if (classification) {
                    const suggestionDiv = document.getElementById('itsmSuggestion');
                    const suggestedType = document.getElementById('suggestedType');
                    const suggestionConfidence = document.getElementById('suggestionConfidence');

                    suggestedType.textContent = classification.type;
                    suggestionConfidence.textContent = `(ä¿¡é ¼åº¦: ${(classification.confidence * 100).toFixed(0)}%)`;
                    suggestionDiv.style.display = 'block';

                    // Suggest tags
                    suggestTags(title, content);
                }
            }, 1000);
        }

        function simulateClassification(title, content) {
            const text = (title + ' ' + content).toLowerCase();

            if (text.includes('ã‚¨ãƒ©ãƒ¼') || text.includes('éšœå®³') || text.includes('503') || text.includes('500')) {
                return { type: 'Incident', confidence: 0.85 };
            } else if (text.includes('æ ¹æœ¬åŸå› ') || text.includes('å•é¡Œ') || text.includes('æ’ä¹…')) {
                return { type: 'Problem', confidence: 0.82 };
            } else if (text.includes('å¤‰æ›´') || text.includes('æ›´æ–°') || text.includes('ssl')) {
                return { type: 'Change', confidence: 0.78 };
            } else if (text.includes('ãƒªãƒªãƒ¼ã‚¹') || text.includes('ãƒ‡ãƒ—ãƒ­ã‚¤')) {
                return { type: 'Release', confidence: 0.80 };
            } else if (text.includes('è¨­å®š') || text.includes('vpn') || text.includes('ã‚¢ã‚¯ã‚»ã‚¹')) {
                return { type: 'Request', confidence: 0.75 };
            }

            return null;
        }

        function suggestTags(title, content) {
            const text = (title + ' ' + content).toLowerCase();
            const tags = [];

            const keywords = {
                'apache': 'Apache',
                'mysql': 'MySQL',
                'ssl': 'SSL',
                'ã‚¨ãƒ©ãƒ¼': 'ã‚¨ãƒ©ãƒ¼å¯¾å¿œ',
                'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹': 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹',
                'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£': 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                'vpn': 'VPN',
                'smtp': 'ãƒ¡ãƒ¼ãƒ«',
            };

            for (const [keyword, tag] of Object.entries(keywords)) {
                if (text.includes(keyword)) {
                    tags.push(tag);
                }
            }

            if (tags.length > 0) {
                const tagSuggestionsDiv = document.getElementById('tagSuggestions');
                tagSuggestionsDiv.innerHTML = `
                    <small style="color: var(--color-text-secondary);">æ¨å¥¨ã‚¿ã‚°: </small>
                    ${tags.map(tag => `<button type="button" class="tag" onclick="addTag('${tag}')">${tag}</button>`).join(' ')}
                `;
            }
        }

        function addTag(tag) {
            const tagsInput = document.getElementById('tags');
            const currentTags = tagsInput.value.split(',').map(t => t.trim()).filter(t => t);

            if (!currentTags.includes(tag)) {
                currentTags.push(tag);
                tagsInput.value = currentTags.join(', ');
            }
        }

        // Event listeners for auto-suggestion
        document.getElementById('title').addEventListener('input', suggestITSMType);
        document.getElementById('content').addEventListener('input', suggestITSMType);

        // Form submission
        function submitKnowledge(event) {
            event.preventDefault();

            const formData = {
                title: document.getElementById('title').value,
                content: document.getElementById('content').value,
                itsmType: document.getElementById('itsmType').value,
                tags: document.getElementById('tags').value,
                createdBy: document.getElementById('createdBy').value,
            };

            // Disable submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span aria-hidden="true">â³</span> ä½œæˆä¸­...';

            // Simulate API call
            setTimeout(() => {
                showAlert('success', 'ãƒŠãƒ¬ãƒƒã‚¸ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼');

                // Redirect to detail page after 1.5 seconds
                setTimeout(() => {
                    window.location.href = 'detail.html?id=new';
                }, 1500);
            }, 1000);

            console.log('Creating knowledge:', formData);
        }

        // Preview functionality
        function previewKnowledge() {
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const itsmType = document.getElementById('itsmType').value;

            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h3>${title || 'ï¼ˆã‚¿ã‚¤ãƒˆãƒ«æœªå…¥åŠ›ï¼‰'}</h3>
                    <span class="badge badge-${itsmType.toLowerCase()}">${itsmType === 'auto' ? 'è‡ªå‹•åˆ¤å®š' : itsmType}</span>
                </div>
                <div style="border-top: 1px solid var(--color-border); padding-top: 1rem;">
                    <pre style="white-space: pre-wrap; font-family: var(--font-family); line-height: 1.8;">${content || 'ï¼ˆå†…å®¹æœªå…¥åŠ›ï¼‰'}</pre>
                </div>
            `;

            document.getElementById('previewModal').classList.add('active');
        }

        function closePreview() {
            document.getElementById('previewModal').classList.remove('active');
        }

        // Close modal on outside click
        document.getElementById('previewModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePreview();
            }
        });

        // Alert helper
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    ${message}
                </div>
            `;

            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Auto-save to localStorage
        let autoSaveTimeout;
        function autoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                const draft = {
                    title: document.getElementById('title').value,
                    content: document.getElementById('content').value,
                    itsmType: document.getElementById('itsmType').value,
                    tags: document.getElementById('tags').value,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('knowledgeDraft', JSON.stringify(draft));
                console.log('Draft auto-saved');
            }, 2000);
        }

        // Load draft on page load
        document.addEventListener('DOMContentLoaded', function() {
            const draft = localStorage.getItem('knowledgeDraft');
            if (draft) {
                const data = JSON.parse(draft);
                if (confirm('ä¿å­˜ã•ã‚ŒãŸä¸‹æ›¸ããŒã‚ã‚Šã¾ã™ã€‚å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ')) {
                    document.getElementById('title').value = data.title || '';
                    document.getElementById('content').value = data.content || '';
                    document.getElementById('itsmType').value = data.itsmType || 'auto';
                    document.getElementById('tags').value = data.tags || '';
                }
            }

            // Add auto-save listeners
            ['title', 'content', 'itsmType', 'tags'].forEach(id => {
                document.getElementById(id).addEventListener('input', autoSave);
            });
        });
    </script>
</body>
</html>
